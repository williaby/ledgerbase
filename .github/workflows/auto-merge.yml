# .github/workflows/auto-merge.yml
# name = auto-merge.yml  # noqa: E265
# description = Automatically approve and merge Dependabot pull requests when labeled
# category = ci  # noqa: E265
# usage = Trigger on Dependabot pull request events (opened, labeled, synchronize)
# behavior = Approves and auto-merges PRs created by dependabot[bot]
# inputs = GitHub pull_request event payload; secrets: GITHUB_TOKEN  # noqa: E265
# outputs = PR merged status  # noqa: E265
# dependencies = step-security/harden-runner@c6295a65d1254861815972266d5933fd6e532bdf, gh CLI  # noqa: E265
# author = Byron Williams  # noqa: E265
# last_modified = 2025-04-17  # noqa: E265
# tags = automation, dependabot  # noqa: E265
# changelog = Pinned runner hardening action SHA; added full metadata header  # noqa: E265

name: Dependabot Auto-Merge

on:
  pull_request:
    types: [opened, labeled, synchronize]

permissions:
  contents: write
  pull-requests: write

jobs:
  auto-merge:
    if: github.actor == 'dependabot[bot]'
    runs-on: ubuntu-latest
    steps:
      - name: Harden the runner (Audit all outbound calls)
        uses: step-security/harden-runner@c6295a65d1254861815972266d5933fd6e532bdf
        with:
          egress-policy: audit

      - name: Approve the PR
        run: |
          gh pr review --approve "$PR_URL"
        env:
          PR_URL: ${{ github.event.pull_request.html_url }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Enable auto-merge
        run: |
          gh pr merge --auto --merge "$PR_URL"
        env:
          PR_URL: ${{ github.event.pull_request.html_url }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
